<div id="thePopUp" class="exit-intent-overlay">
  <section class="exit-intent inline-subscribe">
    <div class="display-table-cell exit-intent__content">
<button onclick="exitPopup()" type="button" id="exitButton" class="close product-comparison--close" data-dismiss="modal" aria-hidden="true">
<i class="fa fa-times" style="position:fixed;" aria-hidden="true"></i>
</button>
<i class="fa fa-spinner fa-spin" style="font-size:48px;" id="videoLoadingSpinner"></i>
<div id="videoWrapper" style="opacity:0;">
  <iframe style="width:100%;height:100%;" id="videoIdToShow"
src="https://www.youtube.com/embed/{{ section.settings.video_id }}?playlist={{ section.settings.video_id }}">
</iframe>
</div>
    </div>
  </section>
</div>
<div class="bt-hero">
    <div class="hero javascript-load-image"
         numBlocks="{{ section.blocks.size }}"
         typeImage="backgroundimagesrc"
            {% for i in section.blocks %}
            {% assign placement = forloop.index %}
        {% for y in (1..6) %}
            {% assign imageSize = y | times: 200 | downcase | append: 'x' %}
            {{ placement }}backgroundimagesrc{{ y | times: 200 }}="{{ i.settings.hero_image | img_url: imageSize }}"

        {% endfor %}
            {% endfor %}>
        <div class="header-text-wrapper small--hide">
            <h1 class="heavy">{{ section.settings.top_header }}</h1>
            <h1 class="heavy" style="margin-left:8%;width:90%;">{{ section.settings.second_header }}</h1>
            <h1 class="heavy" style="margin-left:12%;width:86%;">{{ section.settings.third_header }}</h1>
            <div class="button-wrapper">
                <button onclick="showPopUp()" class="btn btn--small btn--left">
                    <i class="fa fa-caret-right"></i>
                    {{ section.settings.hero_button1text }}</button>
                <a href="{{ section.blocks[0].settings.hero_button2Link }}"
                   class="btn btn--small">{{ section.settings.hero_button2text }}</a></div>
        </div>
    </div>
    <div class="small--show medium--hide large--hide">
        <div class="header-text-wrapper">
            <h1 class="heavy">{{ section.settings.top_header }}</h1>
            <h1 class="heavy" style="margin-left:8%;width:90%;">{{ section.settings.second_header }}</h1>
            <h1 class="heavy" style="margin-left:12%;width:86%;">{{ section.settings.third_header }}</h1>
            <div class="button-wrapper">
                <button onclick="showPopUp()" class="btn btn--small btn--left">
                    <i class="fa fa-caret-right"></i>
                    {{ section.settings.hero_button1text }}</button>
                <a href="{{ section.blocks[0].settings.hero_button2Link }}" class="btn btn--small">
                    {{ section.settings.hero_button2text }}
                </a>
            </div>
        </div>
    </div>
</div>
<style>

#exitButton{
    background: transparent;
    padding: 0;
    border: 0;
    position:absolute;
    cursor:pointer;
    right:10px;
    top:10px;
    width:25px;
}
#exitButton:hover{
  opacity:.5;
}

</style>
<script type="text/javascript">

    var startVideo = function () {
        document.getElementById("videoIdToShow").src += '&autoplay=1';
        var ifr=document.getElementById('videoIdToShow');
        ifr.onload=function(){
            $('#videoLoadingSpinner').hide();
            $('#videoWrapper').animate({
                opacity: 1,
              }, 250, function() {
                ifr.onload = null;
              });
        }
    }

    var stopVideo = function() {
        var ysrc = document.getElementById("videoIdToShow").src;
        var newsrc = ysrc.replace("&autoplay=1", "");
        document.getElementById("videoIdToShow").src = newsrc;
        $('#videoWrapper').css("opacity", 0);
            $('#videoLoadingSpinner').show();
    }
    var exitPopup = function() {
        document.getElementById('thePopUp').classList.remove('show');
        stopVideo();
    };

    var showPopUp = function() {
        $('#thePopUp').addClass('show');
        setTimeout(function() {
            startVideo();
        }, 100);
    }

$(document).ready(function() {
    $('body').on('click', '.exit-intent-overlay', function(e){
        if ( $(e.target).parents('.exit-intent').length === 0 ){
            stopVideo();
        }
    });

    var resizeVideo = function() {
    var widthToSet = $(window).width() - 100;
    var maxWidth = {{ section.settings.video_max_size }};
        if (widthToSet > maxWidth) {
            widthToSet = maxWidth;
        }
    $('#videoWrapper').width(widthToSet);
    };

    window.addEventListener("resize", function() {
        resizeVideo();
    });

resizeVideo();
});

</script>
{% schema %}
    {
    "name":"bt-hero-section",
    "class":"section1",
    "max_blocks":9,
    "settings":[

    {
    "type":"text",
    "id":"top_header",
    "label":"Top Header",
    "default":"A BLENDER AS"
    },
    {
    "type":"text",
    "id":"second_header",
    "label":"Second Header",
    "default":"POWERFUL AS"
    },
    {
    "type":"text",
    "id":"third_header",
    "label":"Third Header",
    "default":"YOUR AMBITION"
    },
    {
    "type":"text",
    "id":"hero_button1text",
    "label":"Hero Button 1 text",
    "default":"WATCH THE VIDEO"
    },
    {
    "type":"text",
    "id":"video_id",
    "label":"Id for youtube video to be shown.",
    "default":"tgbNymZ7vqY",
    "info":"Id for youtube video to be shown. So for 'https://www.youtube.com/watch?v=tgbNymZ7vqY' the id you need to enter is 'tgbNymZ7vqY'"
    },
    {
    "type":"range",
    "id":"video_max_size",
    "min":500,
    "max":2000,
    "step":20,
    "unit":"px",
    "label":"Max Video Size",
    "default":800,
    "info":"Maximum size of the shown video"
    },
    {
    "type":"text",
    "id":"hero_button2text",
    "label":"Hero Button 2 text",
    "default":"SHOP BLENDERS"
    },
    {
    "type": "checkbox",
    "id": "enable_ken_burns",
    "label": "Enable zoom animation",
    "default": false
    },
    {
    "type": "checkbox",
    "id": "enable_progress_bar",
    "default": true,
    "label": "Show progress bar"
    },
    {
    "type": "checkbox",
    "id": "enable_dropshadow",
    "default": false,
    "label": "Show dropshadow",
    "info": "Adds a shadow effect to your slideshow text and buttons."
    },
    {
    "type": "select",
    "id": "color_overlay_opacity",
    "default": "0.8",
    "label": "Overlay opacity",
    "options": [
    {
    "value": "0",
    "label": "Off"
    },
    {
    "value": "0.1",
    "label": "10%"
    },
    {
    "value": "0.2",
    "label": "20%"
    },
    {
    "value": "0.3",
    "label": "30%"
    },
    {
    "value": "0.4",
    "label": "40%"
    },
    {
    "value": "0.5",
    "label": "50%"
    },
    {
    "value": "0.6",
    "label": "60%"
    },
    {
    "value": "0.7",
    "label": "70%"
    },
    {
    "value": "0.8",
    "label": "80%"
    },
    {
    "value": "0.9",
    "label": "90%"
    },
    {
    "value": "1",
    "label": "100%"
    }
    ]
    },
    {
    "type": "color",
    "id": "color_overlay_color",
    "default": "#031207",
    "label": "Overlay color"
    },
    {
    "type": "color",
    "id": "progress_bar_color",
    "default": "#FFFFFF",
    "label": "Progress bar color"
    },
    {
    "type": "color",
    "id": "controls_color",
    "default": "#FFFFFF",
    "label": "Text color"
    },
    {
    "type": "range",
    "label": "Slide Timeout (seconds)",
    "id": "slide_timeout",
    "default": 10,
    "min": 1,
    "max": 30
    }
    ],
    "blocks":[
    {
    "type":"header",
    "name":"hero",
    "settings":[
    {
    "type":"image_picker",
    "id":"hero_image",
    "label":"Hero Image",
    "info":"Landscape orientation (3:2 w:h). 1200 x 752px minimum recommended"
    },
    {
    "type": "url",
    "id": "hero_button2Link",
    "label": "Section 2 Link"
    }
    ]
    }
    ],
    "presets": [
    {
    "name": "bt-hero-section",
    "category": "Image"
    }
    ]
    }
{% endschema %}

